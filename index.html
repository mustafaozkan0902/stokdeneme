<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Depo Stok Takip - Şantiye Elektrik</title>
  <style>
    /* Önceki stil kodları aynen kalsın, modal için eklenenler: */
    /* Modal arka plan */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
    }
    /* Modal içerik kutusu */
    .modal-content {
      background-color: #fefefe;
      margin: 10% auto;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover {
      color: black;
    }
    .product-list {
      max-height: 200px;
      overflow-y: auto;
      margin-top: 10px;
    }
    .product-list label {
      display: block;
      margin: 5px 0;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Depo Stok Takip - Şantiye Elektrik</h1>

  <div id="summary">Toplam Ürün: 0 | Toplam Miktar: 0</div>

  <input type="text" id="search" placeholder="Ürün adı ara..." />

  <form id="product-form">
    <label for="product-name">Ürün:</label>
    <div style="display:flex; gap:10px;">
      <input type="text" id="product-name" readonly placeholder="Ürün seçmek için butona tıklayın" required />
      <button type="button" id="open-modal-btn">Ürün Seç</button>
    </div>

    <label for="product-category">Kategori:</label>
    <select id="product-category" required>
      <option value="">Kategori seçin</option>
      <option value="Vida">Vida</option>
      <option value="Somun">Somun</option>
      <option value="Tava">Tava</option>
      <option value="Busbar">Busbar</option>
      <option value="Kablo">Kablo</option>
      <option value="Kablo Kanalı">Kablo Kanalı</option>
      <option value="Taahhüt Malzemesi">Taahhüt Malzemesi</option>
    </select>

    <label for="product-quantity">Miktar:</label>
    <input type="number" id="product-quantity" min="1" required />

    <label for="product-desc">Açıklama:</label>
    <textarea id="product-desc" rows="2"></textarea>

    <button type="submit">Ürün Ekle</button>
  </form>

  <table id="product-table">
    <thead>
      <tr>
        <th>Ürün Adı</th>
        <th>Kategori</th>
        <th>Miktar</th>
        <th>Açıklama</th>
        <th>İşlem</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Modal Başlangıcı -->
  <div id="product-modal" class="modal">
    <div class="modal-content">
      <span class="close" id="modal-close">&times;</span>
      <h3>Ürün Seçin</h3>
      <div class="product-list" id="modal-product-list">
        <!-- Ürünler buraya JS ile eklenecek -->
      </div>
      <button id="modal-select-btn">Seçimi Onayla</button>
    </div>
  </div>

<script>
  const productsInModal = [
    "Kablo 3x2.5 mm²",
    "Kablo 5x6 mm²",
    "Kablo Kanalı 50x50",
    "Kablo Kanalı 100x50",
    "Busbar 40x10",
    "Busbar 50x10",
    "Somun M6",
    "Somun M8",
    "Vida 4x20",
    "Vida 6x30",
    "Tava 30x50",
    "Taahhüt Montaj Aparatı",
    "Elektrik Sigortası",
    "Panolar için Kablo Bağı",
    "Topraklama Elektrodu"
  ];

  const modal = document.getElementById('product-modal');
  const openModalBtn = document.getElementById('open-modal-btn');
  const modalClose = document.getElementById('modal-close');
  const modalProductList = document.getElementById('modal-product-list');
  const modalSelectBtn = document.getElementById('modal-select-btn');
  const productNameInput = document.getElementById('product-name');

  // Modal ürün listesini oluştur
  function populateModalList() {
    modalProductList.innerHTML = '';
    productsInModal.forEach((product, i) => {
      const label = document.createElement('label');
      label.innerHTML = `
        <input type="radio" name="modal-product" value="${product}" ${i === 0 ? 'checked' : ''}>
        ${product}
      `;
      modalProductList.appendChild(label);
    });
  }

  // Modal açma
  openModalBtn.addEventListener('click', () => {
    populateModalList();
    modal.style.display = 'block';
  });

  // Modal kapatma
  modalClose.addEventListener('click', () => {
    modal.style.display = 'none';
  });
  window.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.style.display = 'none';
    }
  });

  // Seçimi onaylama ve modal kapatma
  modalSelectBtn.addEventListener('click', () => {
    const selected = document.querySelector('input[name="modal-product"]:checked');
    if (selected) {
      productNameInput.value = selected.value;
      modal.style.display = 'none';
    }
  });

  // Diğer form ve tablo kodları (localStorage, listeleme, ekleme, silme, arama) burada olacak
  // Önceki örnek koddan devam edelim:

  const form = document.getElementById('product-form');
  const tableBody = document.querySelector('#product-table tbody');
  const searchInput = document.getElementById('search');
  const summary = document.getElementById('summary');

  let products = JSON.parse(localStorage.getItem('depoStok')) || [];

  function updateSummary() {
    const totalProducts = products.length;
    const totalQuantity = products.reduce((acc, p) => acc + p.quantity, 0);
    summary.textContent = `Toplam Ürün: ${totalProducts} | Toplam Miktar: ${totalQuantity}`;
  }

  function renderProducts(filter = '') {
    tableBody.innerHTML = '';
    const filtered = products.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()));
    filtered.forEach((p, i) => {
      const row = document.createElement('tr');
      if (p.quantity < 5) row.classList.add('low-stock');
      row.innerHTML = `
        <td>${p.name}</td>
        <td>${p.category}</td>
        <td>${p.quantity}</td>
        <td>${p.desc || ''}</td>
        <td><button class="delete-btn" data-index="${i}">Sil</button></td>
      `;
      tableBody.appendChild(row);
    });
  }

  renderProducts();
  updateSummary();

  form.addEventListener('submit', e => {
    e.preventDefault();

    const name = productNameInput.value.trim();
    const category = document.getElementById('product-category').value;
    const quantity = parseInt(document.getElementById('product-quantity').value);
    const desc = document.getElementById('product-desc').value.trim();

    if (!name) {
      alert('Lütfen ürün seçin.');
      return;
    }
    if (!category) {
      alert('Lütfen kategori seçin.');
      return;
    }
    if (quantity < 1 || isNaN(quantity)) {
      alert('Lütfen geçerli bir miktar girin.');
      return;
    }

    products.push({ name, category, quantity, desc });
    localStorage.setItem('depoStok', JSON.stringify(products));

    renderProducts(searchInput.value);
    updateSummary();

    form.reset();
    productNameInput.value = '';
  });

  tableBody.addEventListener('click', e => {
    if (e.target.classList.contains('delete-btn')) {
      const index = e.target.getAttribute('data-index');
      products.splice(index, 1);
      localStorage.setItem('depoStok', JSON.stringify(products));
      renderProducts(searchInput.value);
      updateSummary();
    }
  });

  searchInput.addEventListener('input', () => {
    renderProducts(searchInput.value);
    updateSummary();
  });
</script>
</body>
</html>
